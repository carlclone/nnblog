



# 模拟一个 cpu

深入理解计算机的学习项目之一, 模拟的是一个功能比较简单的 chip 8指令集的 cpu , 并且不带中断功能, 各种事件如按键的触发是通过每次循环的时候检查并执行的

## 大体流程

cpu 的每次执行可以被分解为 取指令, 翻译指令, 执行指令的过程

指令是存放在内存中的, 所以还需要模拟内存, 内存通过一个 stack 结构的数组来模拟

翻译指令通过一个哈希表, 获取执行指令对应触发的函数

执行指令即运行上一步得到的函数

# 寄存器和函数实现

如果实现的是一个类似纸带机的模拟器, 那就只需要一个 PC(Program Counter) 记录当前执行的位置即可

但这里还需要实现函数结构, 所以有一些额外的寄存器

函数的实现在内存中是通过栈来实现的, 栈的特点就是先进后出,后进先出, 和函数的调用关系一样

当最后调用的一个函数弹出的时候, 我们需要知道上一个函数调用的起始位置是哪里, 因此这个起始位置需要被保存起来, 这个位置称为? , 在调用后,在新的栈的前一个位置保存

函数的返回值是通过保持在一个称为 eax 的寄存器中实现的

函数的传参会在调用后,在新的栈处进行拷贝

## CPU 对键盘 IO 事件的处理

## CPU 对声音事件的处理


## 参考资料

## 结尾

学习这个模拟器的本意是希望实现一个 GB 模拟器, 但由于 GB 模拟器的图形方面的模拟难度比较高, 先过了一遍这个相对简单的, 对 CPU软件方面的运行过程有了大致的了解, 但硬件方面比如各种逻辑门的模拟还有待进一步学习 (CS61c/from nand to tetris)