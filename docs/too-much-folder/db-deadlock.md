数据库死锁问题还是挺常见的, 记录下排查过程供以后查阅

没有回滚,导致表加字段的时候卡住

查阅, 某个事务执行了很长时间 , 但是不显示执行的 sql 语句

## 问题复现

## 常见原因

- 事务没有在代码里提交或回滚

这个比较容易遗漏, 避免的方法 1 , 使用 defer 判断 err ,并做回滚或提交
2 , 使用 gorm 提供的事务闭包

- 可重复读隔离级别的间隙锁

避免方法 1 是否能使用提交读级别,可以则修改
2 保证加锁解锁顺序 ( 有点难 )
3 减小事务粒度


开启事务超时?
开启数据库死锁检测(开销大?)
死锁时自动回滚其中一个?

## 排查过程

## 数据库工具/ 参数优化

win10 onetab 里

## 参考资料
win10 onetab 里
xb 备份资料里
geektime

